--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
-- HOTBM instance for function sin(x).
-- wI = 16; wO = 16.
-- Order-2 polynomial approximation.
-- Decomposition:
--   alpha = 5; beta = 11;
--   T_0 (ROM):     alpha_0 = 5; beta_0 = 0;
--   T_1 (PowMult): alpha_1 = 5; beta_1 = 11;
--   T_2 (ROM):     alpha_2 = 2; beta_2 = 5.
-- Guard bits: g = 3.
-- Command line: sin 16 16 2   5   rom 5 0   powmult 5 11  adhoc 11 11  1 0  5 11   rom 2 5


--------------------------------------------------------------------------------
-- TermROM instance for order-0 term.
-- Decomposition:
--   alpha_0 = 5; beta_0 = 0; wO_0 = 19.

library ieee;
use ieee.std_logic_1164.all;
use ieee.std_logic_arith.all;
use ieee.std_logic_unsigned.all;

entity sin_16_16_2_t0 is
  port ( a : in  std_logic_vector(4 downto 0);
         r : out std_logic_vector(19 downto 0) );
end entity;

architecture arch of sin_16_16_2_t0 is
  signal x0   : std_logic_vector(4 downto 0);
  signal r0   : std_logic_vector(18 downto 0);
begin
  x0 <= a;

  with x0 select
    r0 <= "0000001100100100101" when "00000", -- t[0] = 6437
          "0000100101101100100" when "00001", -- t[1] = 19300
          "0000111110110011000" when "00010", -- t[2] = 32152
          "0001010111110111000" when "00011", -- t[3] = 44984
          "0001110000110111101" when "00100", -- t[4] = 57789
          "0010001001110100000" when "00101", -- t[5] = 70560
          "0010100010101011000" when "00110", -- t[6] = 83288
          "0010111011011011101" when "00111", -- t[7] = 95965
          "0011010100000101101" when "01000", -- t[8] = 108589
          "0011101100100111000" when "01001", -- t[9] = 121144
          "0100000100111111001" when "01010", -- t[10] = 133625
          "0100011101001101010" when "01011", -- t[11] = 146026
          "0100110101010000011" when "01100", -- t[12] = 158339
          "0101001101000111101" when "01101", -- t[13] = 170557
          "0101100100110010000" when "01110", -- t[14] = 182672
          "0101111100001110101" when "01111", -- t[15] = 194677
          "0110010011011101001" when "10000", -- t[16] = 206569
          "0110101010011011100" when "10001", -- t[17] = 218332
          "0111000001001001100" when "10010", -- t[18] = 229964
          "0111010111100110001" when "10011", -- t[19] = 241457
          "0111101101110000100" when "10100", -- t[20] = 252804
          "1000000011101000000" when "10101", -- t[21] = 264000
          "1000011001001011100" when "10110", -- t[22] = 275036
          "1000101110011010011" when "10111", -- t[23] = 285907
          "1001000011010100010" when "11000", -- t[24] = 296610
          "1001010111110111010" when "11001", -- t[25] = 307130
          "1001101100000011001" when "11010", -- t[26] = 317465
          "1001111111110111001" when "11011", -- t[27] = 327609
          "1010010011010010011" when "11100", -- t[28] = 337555
          "1010100110010100010" when "11101", -- t[29] = 347298
          "1010111000111100000" when "11110", -- t[30] = 356832
          "1011001011001000111" when "11111", -- t[31] = 366151
          "-------------------" when others;

  r(18 downto 0) <= r0;
  r(19 downto 19) <= (19 downto 19 => ('0'));
end architecture;


--------------------------------------------------------------------------------
-- PowerAdHoc instance for order-1 powering unit.
-- Decomposition:
--   beta_1 = 11; mu_1 = 11; lambda_1 = 11.

library ieee;
use ieee.std_logic_1164.all;
use ieee.std_logic_arith.all;
use ieee.std_logic_unsigned.all;

entity sin_16_16_2_t1_pow is
  port ( x : in  std_logic_vector(9 downto 0);
         r : out std_logic_vector(10 downto 0) );
end entity;

architecture arch of sin_16_16_2_t1_pow is
  signal pp0 : std_logic_vector(9 downto 0);
  signal r0 : std_logic_vector(9 downto 0);
begin
  pp0(9) <= x(9);

  pp0(8) <= x(8);

  pp0(7) <= x(7);

  pp0(6) <= x(6);

  pp0(5) <= x(5);

  pp0(4) <= x(4);

  pp0(3) <= x(3);

  pp0(2) <= x(2);

  pp0(1) <= x(1);

  pp0(0) <= x(0);

  r0 <= pp0;
  r <= "1" & r0(9 downto 0);
end architecture;


--------------------------------------------------------------------------------
-- TermPowMult::Table instance for order-1 term Q_1.
-- Decomposition:
--   alpha_1,1 = 5; wO_1,1 = 13.

library ieee;
use ieee.std_logic_1164.all;
use ieee.std_logic_arith.all;
use ieee.std_logic_unsigned.all;

entity sin_16_16_2_t1_t1 is
  port ( a : in  std_logic_vector(4 downto 0);
         r : out std_logic_vector(12 downto 0) );
end entity;

architecture arch of sin_16_16_2_t1_t1 is
  signal x : std_logic_vector(4 downto 0);
begin
  x <= a;

  with x select
    r <= "1100100100001" when "00000", -- t[0] = 6433
         "1100100011110" when "00001", -- t[1] = 6430
         "1100100010110" when "00010", -- t[2] = 6422
         "1100100001010" when "00011", -- t[3] = 6410
         "1100011111011" when "00100", -- t[4] = 6395
         "1100011100111" when "00101", -- t[5] = 6375
         "1100011010000" when "00110", -- t[6] = 6352
         "1100010110101" when "00111", -- t[7] = 6325
         "1100010010110" when "01000", -- t[8] = 6294
         "1100001110100" when "01001", -- t[9] = 6260
         "1100001001101" when "01010", -- t[10] = 6221
         "1100000100011" when "01011", -- t[11] = 6179
         "1011111110101" when "01100", -- t[12] = 6133
         "1011111000100" when "01101", -- t[13] = 6084
         "1011110001111" when "01110", -- t[14] = 6031
         "1011101010110" when "01111", -- t[15] = 5974
         "1011100011001" when "10000", -- t[16] = 5913
         "1011011011001" when "10001", -- t[17] = 5849
         "1011010010110" when "10010", -- t[18] = 5782
         "1011001001111" when "10011", -- t[19] = 5711
         "1011000000101" when "10100", -- t[20] = 5637
         "1010110110111" when "10101", -- t[21] = 5559
         "1010101100110" when "10110", -- t[22] = 5478
         "1010100010001" when "10111", -- t[23] = 5393
         "1010010111001" when "11000", -- t[24] = 5305
         "1010001011110" when "11001", -- t[25] = 5214
         "1010000000000" when "11010", -- t[26] = 5120
         "1001110011111" when "11011", -- t[27] = 5023
         "1001100111011" when "11100", -- t[28] = 4923
         "1001011010100" when "11101", -- t[29] = 4820
         "1001001101010" when "11110", -- t[30] = 4714
         "1000111111101" when "11111", -- t[31] = 4605
         "-------------" when others;
end architecture;


--------------------------------------------------------------------------------
-- TermPowMult instance for order-1 term.
-- Decomposition:
--   alpha_1 = 5; beta_1 = 11; lambda_1 = 11;  m_1 = 1;
--   Pow   (AdHoc);
--   Q_1,1 (Mult): alpha_1,1 = 5; rho_1,1 = 0; sigma_1,1 = 11; wO_1,1 = 13.

library ieee;
use ieee.std_logic_1164.all;
use ieee.std_logic_arith.all;
use ieee.std_logic_unsigned.all;

entity sin_16_16_2_t1 is
  port ( a : in  std_logic_vector(4 downto 0);
         b : in  std_logic_vector(10 downto 0);
         r : out std_logic_vector(19 downto 0) );
end entity;

architecture arch of sin_16_16_2_t1 is
  signal sign   : std_logic;
  signal b0     : std_logic_vector(9 downto 0);
  signal s      : std_logic_vector(10 downto 0);
  component sin_16_16_2_t1_pow is
    port ( x : in  std_logic_vector(9 downto 0);
           r : out std_logic_vector(10 downto 0) );
  end component;

  signal a_1    : std_logic_vector(4 downto 0);
  signal sign_1 : std_logic;
  signal s_1    : std_logic_vector(9 downto 0);
  signal k_1    : std_logic_vector(12 downto 0);
  signal r0_1   : std_logic_vector(23 downto 0);
  signal r_1    : std_logic_vector(19 downto 0);
  component sin_16_16_2_t1_t1 is
    port ( a : in  std_logic_vector(4 downto 0);
           r : out std_logic_vector(12 downto 0) );
  end component;
begin
  sign <= not b(10);
  b0 <= b(9 downto 0) xor (9 downto 0 => sign);

  pow : sin_16_16_2_t1_pow
    port map ( x => b0,
               r => s );

  a_1 <= a(4 downto 0);
  sign_1 <= not s(10);
  s_1 <= s(9 downto 0) xor (9 downto 0 => sign_1);
  t_1 : sin_16_16_2_t1_t1
    port map ( a => a_1,
               r => k_1 );
  r0_1 <= k_1 * (s_1 & "1");
  r_1(12 downto 0) <=
    r0_1(23 downto 11) xor (23 downto 11 => ((sign xor sign_1)));
  r_1(19 downto 13) <= (19 downto 13 => ((sign xor sign_1)));

  r <= r_1;
end architecture;


--------------------------------------------------------------------------------
-- TermROM instance for order-2 term.
-- Decomposition:
--   alpha_2 = 2; beta_2 = 5 (1+4); wO_2 = 5.

library ieee;
use ieee.std_logic_1164.all;
use ieee.std_logic_arith.all;
use ieee.std_logic_unsigned.all;

entity sin_16_16_2_t2 is
  port ( a : in  std_logic_vector(1 downto 0);
         b : in  std_logic_vector(4 downto 0);
         r : out std_logic_vector(19 downto 0) );
end entity;

architecture arch of sin_16_16_2_t2 is
  signal sign : std_logic;
  signal b0   : std_logic_vector(3 downto 0);
  signal x0   : std_logic_vector(5 downto 0);
  signal r0   : std_logic_vector(4 downto 0);
begin
  sign <= not b(4);
  b0 <= b(3 downto 0) xor (3 downto 0 => sign);
  x0 <= a & b0;

  with x0 select
    r0 <= "11111" when "000000", -- t[0] = -1
          "11111" when "000001", -- t[1] = -1
          "11111" when "000010", -- t[2] = -1
          "11111" when "000011", -- t[3] = -1
          "11111" when "000100", -- t[4] = -1
          "11111" when "000101", -- t[5] = -1
          "11111" when "000110", -- t[6] = -1
          "11111" when "000111", -- t[7] = -1
          "11110" when "001000", -- t[8] = -2
          "11110" when "001001", -- t[9] = -2
          "11110" when "001010", -- t[10] = -2
          "11110" when "001011", -- t[11] = -2
          "11101" when "001100", -- t[12] = -3
          "11101" when "001101", -- t[13] = -3
          "11100" when "001110", -- t[14] = -4
          "11100" when "001111", -- t[15] = -4
          "11111" when "010000", -- t[16] = -1
          "11111" when "010001", -- t[17] = -1
          "11111" when "010010", -- t[18] = -1
          "11111" when "010011", -- t[19] = -1
          "11111" when "010100", -- t[20] = -1
          "11110" when "010101", -- t[21] = -2
          "11110" when "010110", -- t[22] = -2
          "11101" when "010111", -- t[23] = -3
          "11100" when "011000", -- t[24] = -4
          "11011" when "011001", -- t[25] = -5
          "11011" when "011010", -- t[26] = -5
          "11010" when "011011", -- t[27] = -6
          "11001" when "011100", -- t[28] = -7
          "10111" when "011101", -- t[29] = -9
          "10110" when "011110", -- t[30] = -10
          "10101" when "011111", -- t[31] = -11
          "11111" when "100000", -- t[32] = -1
          "11111" when "100001", -- t[33] = -1
          "11111" when "100010", -- t[34] = -1
          "11111" when "100011", -- t[35] = -1
          "11110" when "100100", -- t[36] = -2
          "11101" when "100101", -- t[37] = -3
          "11100" when "100110", -- t[38] = -4
          "11011" when "100111", -- t[39] = -5
          "11010" when "101000", -- t[40] = -6
          "11001" when "101001", -- t[41] = -7
          "10111" when "101010", -- t[42] = -9
          "10110" when "101011", -- t[43] = -10
          "10100" when "101100", -- t[44] = -12
          "10010" when "101101", -- t[45] = -14
          "10000" when "101110", -- t[46] = -16
          "01110" when "101111", -- t[47] = -18
          "11111" when "110000", -- t[48] = -1
          "11111" when "110001", -- t[49] = -1
          "11111" when "110010", -- t[50] = -1
          "11110" when "110011", -- t[51] = -2
          "11110" when "110100", -- t[52] = -2
          "11101" when "110101", -- t[53] = -3
          "11011" when "110110", -- t[54] = -5
          "11010" when "110111", -- t[55] = -6
          "11000" when "111000", -- t[56] = -8
          "10111" when "111001", -- t[57] = -9
          "10101" when "111010", -- t[58] = -11
          "10011" when "111011", -- t[59] = -13
          "10000" when "111100", -- t[60] = -16
          "01110" when "111101", -- t[61] = -18
          "01011" when "111110", -- t[62] = -21
          "01000" when "111111", -- t[63] = -24
          "-----" when others;

  r(4 downto 0) <= r0;
  r(19 downto 5) <= (19 downto 5 => (not '0'));
end architecture;


--------------------------------------------------------------------------------
-- HOTBM main component.

library ieee;
use ieee.std_logic_1164.all;
use ieee.std_logic_arith.all;
use ieee.std_logic_unsigned.all;

entity sin_16_16_2 is
  port ( x : in  std_logic_vector(15 downto 0);
         r : out std_logic_vector(16 downto 0) );
end entity;

architecture arch of sin_16_16_2 is
  signal a_0 : std_logic_vector(4 downto 0);
  signal r_0 : std_logic_vector(19 downto 0);
  component sin_16_16_2_t0 is
    port ( a : in  std_logic_vector(4 downto 0);
           r : out std_logic_vector(19 downto 0) );
  end component;

  signal a_1 : std_logic_vector(4 downto 0);
  signal b_1 : std_logic_vector(10 downto 0);
  signal r_1 : std_logic_vector(19 downto 0);
  component sin_16_16_2_t1 is
    port ( a : in  std_logic_vector(4 downto 0);
           b : in  std_logic_vector(10 downto 0);
           r : out std_logic_vector(19 downto 0) );
  end component;

  signal a_2 : std_logic_vector(1 downto 0);
  signal b_2 : std_logic_vector(4 downto 0);
  signal r_2 : std_logic_vector(19 downto 0);
  component sin_16_16_2_t2 is
    port ( a : in  std_logic_vector(1 downto 0);
           b : in  std_logic_vector(4 downto 0);
           r : out std_logic_vector(19 downto 0) );
  end component;

  signal sum : std_logic_vector(19 downto 0);
begin
  a_0 <= x(15 downto 11);
  t_0 : sin_16_16_2_t0
    port map ( a => a_0,
               r => r_0 );

  a_1 <= x(15 downto 11);
  b_1 <= x(10 downto 0);
  t_1 : sin_16_16_2_t1
    port map ( a => a_1,
               b => b_1,
               r => r_1 );

  a_2 <= x(15 downto 14);
  b_2 <= x(10 downto 6);
  t_2 : sin_16_16_2_t2
    port map ( a => a_2,
               b => b_2,
               r => r_2 );

  sum <= r_0 + r_1 + r_2;
  r <= sum(19 downto 3);
end architecture;
