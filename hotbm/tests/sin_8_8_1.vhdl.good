--------------------------------------------------------------------------------
--------------------------------------------------------------------------------
-- HOTBM instance for function sin(x).
-- wI = 8; wO = 8.
-- Order-1 polynomial approximation.
-- Decomposition:
--   alpha = 4; beta = 4;
--   T_0 (ROM):     alpha_0 = 4; beta_0 = 0;
--   T_1 (ROM):     alpha_1 = 2; beta_1 = 4.
-- Guard bits: g = 2.
-- Command line: sin 8 8 1   4   rom 4 0   rom 2 4


--------------------------------------------------------------------------------
-- TermROM instance for order-0 term.
-- Decomposition:
--   alpha_0 = 4; beta_0 = 0; wO_0 = 10.

library ieee;
use ieee.std_logic_1164.all;
use ieee.std_logic_arith.all;
use ieee.std_logic_unsigned.all;

entity sin_8_8_1_t0 is
  port ( a : in  std_logic_vector(3 downto 0);
         r : out std_logic_vector(10 downto 0) );
end entity;

architecture arch of sin_8_8_1_t0 is
  signal x0   : std_logic_vector(3 downto 0);
  signal r0   : std_logic_vector(9 downto 0);
begin
  x0 <= a;

  with x0 select
    r0 <= "0000011010" when "0000", -- t[0] = 26
          "0001001100" when "0001", -- t[1] = 76
          "0001111110" when "0010", -- t[2] = 126
          "0010101111" when "0011", -- t[3] = 175
          "0011100001" when "0100", -- t[4] = 225
          "0100010010" when "0101", -- t[5] = 274
          "0101000010" when "0110", -- t[6] = 322
          "0101110001" when "0111", -- t[7] = 369
          "0110011111" when "1000", -- t[8] = 415
          "0111001101" when "1001", -- t[9] = 461
          "0111111001" when "1010", -- t[10] = 505
          "1000100100" when "1011", -- t[11] = 548
          "1001001110" when "1100", -- t[12] = 590
          "1001110111" when "1101", -- t[13] = 631
          "1010011110" when "1110", -- t[14] = 670
          "1011000011" when "1111", -- t[15] = 707
          "----------" when others;

  r(9 downto 0) <= r0;
  r(10 downto 10) <= (10 downto 10 => ('0'));
end architecture;


--------------------------------------------------------------------------------
-- TermROM instance for order-1 term.
-- Decomposition:
--   alpha_1 = 2; beta_1 = 4 (1+3); wO_1 = 5.

library ieee;
use ieee.std_logic_1164.all;
use ieee.std_logic_arith.all;
use ieee.std_logic_unsigned.all;

entity sin_8_8_1_t1 is
  port ( a : in  std_logic_vector(1 downto 0);
         b : in  std_logic_vector(3 downto 0);
         r : out std_logic_vector(10 downto 0) );
end entity;

architecture arch of sin_8_8_1_t1 is
  signal sign : std_logic;
  signal b0   : std_logic_vector(2 downto 0);
  signal x0   : std_logic_vector(4 downto 0);
  signal r0   : std_logic_vector(4 downto 0);
begin
  sign <= not b(3);
  b0 <= b(2 downto 0) xor (2 downto 0 => sign);
  x0 <= a & b0;

  with x0 select
    r0 <= "00001" when "00000", -- t[0] = 1
          "00100" when "00001", -- t[1] = 4
          "00111" when "00010", -- t[2] = 7
          "01010" when "00011", -- t[3] = 10
          "01110" when "00100", -- t[4] = 14
          "10001" when "00101", -- t[5] = 17
          "10100" when "00110", -- t[6] = 20
          "10111" when "00111", -- t[7] = 23
          "00001" when "01000", -- t[8] = 1
          "00100" when "01001", -- t[9] = 4
          "00111" when "01010", -- t[10] = 7
          "01010" when "01011", -- t[11] = 10
          "01101" when "01100", -- t[12] = 13
          "10000" when "01101", -- t[13] = 16
          "10011" when "01110", -- t[14] = 19
          "10110" when "01111", -- t[15] = 22
          "00001" when "10000", -- t[16] = 1
          "00100" when "10001", -- t[17] = 4
          "00110" when "10010", -- t[18] = 6
          "01001" when "10011", -- t[19] = 9
          "01100" when "10100", -- t[20] = 12
          "01111" when "10101", -- t[21] = 15
          "10001" when "10110", -- t[22] = 17
          "10100" when "10111", -- t[23] = 20
          "00001" when "11000", -- t[24] = 1
          "00011" when "11001", -- t[25] = 3
          "00110" when "11010", -- t[26] = 6
          "01000" when "11011", -- t[27] = 8
          "01010" when "11100", -- t[28] = 10
          "01101" when "11101", -- t[29] = 13
          "01111" when "11110", -- t[30] = 15
          "10010" when "11111", -- t[31] = 18
          "-----" when others;

  r(4 downto 0) <= r0 xor (4 downto 0 => (sign));
  r(10 downto 5) <= (10 downto 5 => (sign));
end architecture;


--------------------------------------------------------------------------------
-- HOTBM main component.

library ieee;
use ieee.std_logic_1164.all;
use ieee.std_logic_arith.all;
use ieee.std_logic_unsigned.all;

entity sin_8_8_1 is
  port ( x : in  std_logic_vector(7 downto 0);
         r : out std_logic_vector(8 downto 0) );
end entity;

architecture arch of sin_8_8_1 is
  signal a_0 : std_logic_vector(3 downto 0);
  signal r_0 : std_logic_vector(10 downto 0);
  component sin_8_8_1_t0 is
    port ( a : in  std_logic_vector(3 downto 0);
           r : out std_logic_vector(10 downto 0) );
  end component;

  signal a_1 : std_logic_vector(1 downto 0);
  signal b_1 : std_logic_vector(3 downto 0);
  signal r_1 : std_logic_vector(10 downto 0);
  component sin_8_8_1_t1 is
    port ( a : in  std_logic_vector(1 downto 0);
           b : in  std_logic_vector(3 downto 0);
           r : out std_logic_vector(10 downto 0) );
  end component;

  signal sum : std_logic_vector(10 downto 0);
begin
  a_0 <= x(7 downto 4);
  t_0 : sin_8_8_1_t0
    port map ( a => a_0,
               r => r_0 );

  a_1 <= x(7 downto 6);
  b_1 <= x(3 downto 0);
  t_1 : sin_8_8_1_t1
    port map ( a => a_1,
               b => b_1,
               r => r_1 );

  sum <= r_0 + r_1;
  r <= sum(10 downto 2);
end architecture;
